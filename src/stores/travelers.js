// src/stores/travelers.js
import { defineStore } from 'pinia'
import { ref } from 'vue'

// --- è¼”åŠ©æ•¸æ“šï¼šæ—…éŠäººæ ¼ (èˆ‡ discussions.js ä¿æŒä¸€è‡´) ---
const travelPersonalities = [
  { emoji: 'ğŸ¦', label: 'æ¨‚å¤©æ´¾' },
  { emoji: 'ğŸ¦‰', label: 'è§€å¯Ÿå®¶' },
  { emoji: 'ğŸ¦…', label: 'å†’éšªç‹' },
  { emoji: 'ğŸº', label: 'ç¨è¡Œè€…' },
  { emoji: 'ğŸ§', label: 'æ…¢æ´»è€…' },
  { emoji: 'ğŸ¦Š', label: 'è—è¡“å®¶' },
  { emoji: 'ğŸ¼', label: 'ç¾é£Ÿå®¶' },
  { emoji: 'ğŸ¦‹', label: 'è¿½å¤¢äºº' },
  { emoji: 'ğŸ¢', label: 'ä½›ç³»æ´¾' },
  { emoji: 'ğŸ¬', label: 'äº¤éš›èŠ±' },
]

// --- æ—…ä¼´è«‹æ±‚æ¨¡æ¿ ---
const travelerRequests = [
  {
    title: 'å¾µæ±‚ä¸€ä½å¥³ç”Ÿåˆ†æ”¤æœ­å¹Œä½å®¿è²» (å·²è¨‚æˆ¿)',
    location: 'æ—¥æœ¬',
    tag: 'çœéŒ¢',
    status: 'æ‹›å‹Ÿä¸­',
    people: '1/3',
    content:
      'æˆ‘å€‘å·²ç¶“è¨‚å¥½äº†æœ­å¹Œå¸‚å€çš„è±ªè¯å…¬å¯“ï¼Œä½†é‚„å·®ä¸€ä½å¥³ç”Ÿåˆ†æ”¤ä½å®¿è²»ï¼Œæ—¥æœŸç‚º 12/20-12/24ï¼Œä½å®¿å“è³ªå¾ˆå¥½ï¼Œæ­¡è¿é ç®—æœ‰é™ä½†æ„›ä¹¾æ·¨çš„å¥³ç”ŸåŠ å…¥ã€‚',
  },
  {
    title: 'æ­æ´²è‡ªåŠ© 40 å¤©ï¼Œæ±‚å¥½ç›¸è™•æ—…ä¼´ä¸€èµ·è¦åŠƒ',
    location: 'æ­æ´²',
    tag: 'è‡ªåŠ©',
    status: 'æ‹›å‹Ÿä¸­',
    people: '2/4',
    content:
      'é è¨ˆæ˜å¹´äº”æœˆå‡ºç™¼ï¼Œå¾è‘¡è„ç‰™é‡Œæ–¯æœ¬é–‹å§‹ï¼Œä¸€è·¯ç©åˆ°ç¾©å¤§åˆ©ç¾…é¦¬ï¼Œè¡Œç¨‹é¬†æ•£ä¸è¶•ï¼Œå¸Œæœ›æ‰¾åˆ°å¯ä»¥ä¸€èµ·åˆ†æ”¤äº¤é€šå’Œè¦åŠƒè¡Œç¨‹çš„å¤¥ä¼´ã€‚å–œæ­¡æ­·å²ã€å»ºç¯‰ã€å’Œç¾é£Ÿçš„å„ªå…ˆã€‚',
  },
  {
    title: 'é¨æ©Ÿè»Šç’°å³¶ï¼ç¼ºä¸€ä½æ”å½±å¸«å¹«å¿™ç´€éŒ„',
    location: 'å°ç£',
    tag: 'æ”å½±',
    status: 'å·²é¡æ»¿',
    people: '2/2',
    content:
      'å·²å‡ºç™¼ï¼è·¯ç·šæ˜¯å°ä¸‰ç·šï¼Œå°‹æ‰¾ä¸€ä½ç†Ÿæ‚‰æ”å½±ä¸¦å…·å‚™åŸºæœ¬é¨è»ŠæŠ€èƒ½çš„å¤¥ä¼´ï¼Œä¸»è¦ä»»å‹™æ˜¯å¹«å¿™åœ¨å„å€‹é¢¨æ™¯é»æŠ“æ‹ï¼Œç´€éŒ„ä¸‹æœ€ç¾çš„é¢¨æ™¯å’Œäººæƒ…å‘³ã€‚è²»ç”¨å…¨åŒ…ï¼Œåªæ±‚æŠ€è¡“ï¼',
  },
  {
    title: 'æ›¼è°·çˆ†é£Ÿåœ˜ï¼ç›®æ¨™åƒéæ‰€æœ‰ç±³å…¶æ—è·¯é‚Šæ”¤',
    location: 'æ³°åœ‹',
    tag: 'ç¾é£Ÿ',
    status: 'æ‹›å‹Ÿä¸­',
    people: '3/5',
    content:
      'ç›®æ¨™é–å®šæ›¼è°·æœ€å—æ­¡è¿çš„ç±³å…¶æ—è¡—é ­å°åƒå’Œå¤œå¸‚ï¼ŒåŒ…å« Jay Fai å’Œå„ç¨®åœ¨åœ°äººæ°£åº—ã€‚æˆ‘å€‘éœ€è¦èƒƒå®¹é‡å¤ å¤§ï¼Œä¸”ä¸æ€•æ’éšŠã€æ•¢æ–¼å˜—è©¦å„ç¨®å£å‘³çš„åƒè²¨åŠ å…¥ï¼',
  },
  {
    title: 'äº¬éƒ½ç©¿å’Œæœäº’æ‹ï¼Œä¸æƒ³ä¸€ç›´è‡ªæ‹æ±‚éšŠå‹',
    location: 'æ—¥æœ¬',
    tag: 'æ”å½±',
    status: 'æ‹›å‹Ÿä¸­',
    people: '1/2',
    content:
      'åäºŒæœˆåˆåœ¨äº¬éƒ½è³æ¥“ï¼Œæƒ³æ‰¾ä¸€ä½ç†±æ„›æ‹ç…§çš„å¥³ç”Ÿï¼Œå¯ä»¥äº’ç›¸æ­é…å’Œæœï¼Œä¸€èµ·åœ¨æ¸…æ°´å¯ºå’Œåµå±±ç­‰åœ°é»äº’æ‹ç¾ç…§ã€‚è¡Œç¨‹éå¸¸å½ˆæ€§ï¼Œä¸»è¦ä»¥æ‹ç…§ç‚ºä¸»ï¼Œæ­¡è¿æœ‰ç¶“é©—çš„æ¨¡ç‰¹æˆ–æ”å½±å¸«ã€‚',
  },
  {
    title: 'å†°å³¶è‡ªé§•ç¼ºå¸æ©Ÿï¼ä¸€èµ·åˆ†æ”¤ç§Ÿè»Šæ²¹éŒ¢',
    location: 'å†°å³¶',
    tag: 'è‡ªé§•',
    status: 'å·²å‡ºç™¼',
    people: '3/3',
    content:
      'æˆ‘å€‘å·²ç¶“æœ‰ä¸‰å€‹äººï¼Œé‚„ç¼ºä¸€ä½æœ‰é›ªåœ°é§•é§›ç¶“é©—çš„å¸æ©Ÿã€‚æ™‚é–“æ˜¯ä¸‰æœˆè¿½æ¥µå…‰ï¼Œä¸»è¦è·‘å—å²¸ç’°ç·šã€‚æ²¹éŒ¢ã€ç§Ÿè»Šè²»ã€ä½å®¿è²»å¤§å®¶å¹³å‡åˆ†æ”¤ï¼Œå¿«ä¾†åŠ å…¥é€™è¶Ÿå†°é›ªå¥‡ç·£ä¹‹æ—…ï¼',
  },
  {
    title: 'ç´ç´„æ™‚ä»£å»£å ´è·¨å¹´ï¼Œå¾µäººä¸€èµ·åŒ…å°¿å¸ƒæ’éšŠ',
    location: 'ç¾åœ‹',
    tag: 'è·¨å¹´',
    status: 'æ‹›å‹Ÿä¸­',
    people: '1/5',
    content:
      'å¦‚æœä½ ä¹Ÿå¤¢æƒ³åœ¨æ™‚ä»£å»£å ´è¿æ¥æ–°å¹´ï¼Œç¾åœ¨å°±æ˜¯åŠ å…¥çš„æ©Ÿæœƒï¼æˆ‘å€‘éœ€è¦å››ä½ä¸æ€•å†·ã€æœ‰è€å¿ƒã€ä¸”é¡˜æ„ä¸€èµ·é«”é©—æ¥µé™è·¨å¹´æ’éšŠçš„å¤¥ä¼´ã€‚è«‹è‡ªå‚™æˆäººç´™å°¿è¤²å’Œæ‰€æœ‰ä¿æš–è£å‚™ã€‚',
  },
  {
    title: 'é¦–çˆ¾æ»‘é›ªåœ˜ï¼Œæƒ³æ‰¾äººä¸€èµ·è«‹æ•™ç·´ (åˆ†æ”¤æ•™ç·´è²»)',
    location: 'éŸ“åœ‹',
    tag: 'æ»‘é›ª',
    status: 'æ‹›å‹Ÿä¸­',
    people: '2/3',
    content:
      'æˆ‘å€‘æ˜¯æ»‘é›ªæ–°æ‰‹ï¼Œæƒ³æ‰¾ä¸€ä½ä¸€èµ·åˆ†æ”¤ç§äººæ•™ç·´è²»çš„å¤¥ä¼´ï¼Œé è¨ˆåœ¨é¾å¹³æ»‘é›ªå ´å¾…ä¸‰å¤©å…©å¤œã€‚å¦‚æœä½ ä¹Ÿæ˜¯æ–°æ‰‹ï¼Œæˆ–è€…é¡˜æ„ä¸€èµ·å­¸ç¿’ï¼Œå¿«ä¾†ç§è¨Šæˆ‘ï¼',
  },
  {
    title: 'è¶Šå—å³´æ¸¯æ”¾ç©ºï¼Œåªæƒ³èººåœ¨æ²™ç˜ä¸æƒ³è·‘è¡Œç¨‹',
    location: 'è¶Šå—',
    tag: 'åº¦å‡',
    status: 'å·²é¡æ»¿',
    people: '1/1',
    content:
      'é€™æ˜¯ä¸€è¶Ÿå®Œå…¨ä½›ç³»çš„å³´æ¸¯ä¹‹æ—…ï¼Œä¸éœ€è¦ä»»ä½•è¡Œç¨‹ï¼Œåªéœ€è¦åœ¨æ²™ç˜ã€æ³³æ± ã€æˆ–å’–å•¡å»³æ”¾ç©ºã€‚å¦‚æœä½ ä¹Ÿæ˜¯è¨å­è·‘æ™¯é»çš„æ¥µç°¡ä¸»ç¾©è€…ï¼Œæ­¡è¿åŠ å…¥ï¼Œæˆ‘å€‘ç›®æ¨™å°±æ˜¯èººå¹³ï¼',
  },
  {
    title: 'è¥¿è—è½‰å±±ï¼Œå¾µæ±‚é«”åŠ›å¥½æœ‰é«˜å±±ç¶“é©—çš„å¤¥ä¼´',
    location: 'ä¸­åœ‹',
    tag: 'å¥è¡Œ',
    status: 'æ‹›å‹Ÿä¸­',
    people: '4/6',
    content:
      'é è¨ˆåœ¨ä¹æœˆå‰å¾€è¥¿è—ï¼Œé€²è¡Œç‚ºæœŸå…©é€±çš„æœè–ä¹‹æ—…ï¼ŒåŒ…å«æ‹‰è–©åŠå²¡ä»æ³¢é½Šè½‰å±±ã€‚è¦æ±‚æœ‰é«˜æµ·æ‹”å¥è¡Œç¶“é©—ï¼Œèº«é«”ç´ è³ªå¥½ï¼Œä¸¦ä¸”èƒ½éµå®ˆåœ˜éšŠç´€å¾‹ã€‚',
  },
]

// è¼”åŠ©æ•¸æ“šï¼šå¯ç”¨æ¨™ç±¤
const availableTags = [
  'çœéŒ¢',
  'æ”å½±',
  'ç¾é£Ÿ',
  'è‡ªåŠ©',
  'è‡ªé§•',
  'è·¨å¹´',
  'æ»‘é›ª',
  'åº¦å‡',
  'å¥è¡Œ',
  'æ–‡åŒ–',
  'æ¥µå…‰',
  'æ²™ç˜',
  'ç™»å±±',
  'æ–°æ‰‹å‹å–„',
  'é™å¥³ç”Ÿ',
  'æƒ…ä¾¶é©ç”¨',
  'è¦ªå­éŠ',
]

// è¼”åŠ©å‡½å¼ï¼šå¾æ¨™ç±¤åº«ä¸­éš¨æ©Ÿé¸å– 1-3 å€‹æ¨™ç±¤
const getRandomTags = (count) => {
  const maxCount = Math.min(3, count)
  const minCount = 1
  const actualCount = Math.floor(Math.random() * (maxCount - minCount + 1)) + minCount

  const shuffled = availableTags.sort(() => 0.5 - Math.random())
  return shuffled.slice(0, actualCount)
}

// è¼”åŠ©å‡½å¼ï¼šç”Ÿæˆæ—…ä¼´ç•™è¨€æ•¸æ“š (ç°¡åŒ–ç‰ˆ)
const generateTravelerComments = (postId, title) => {
  // æ¯å€‹æ—…ä¼´è²¼æ–‡ç”¢ç”Ÿ 3 å‰‡ç•™è¨€ + 1 å‰‡å›è¦†
  const commentsData = [
    {
      author: 'å°é™³',
      content: `å°æ‚¨çš„${title.substring(0, 5)}æ‹›å‹Ÿå¾ˆæœ‰èˆˆè¶£ï¼Œè«‹å•å…·é«”å‡ºç™¼æ—¥æœŸç¢ºå®šäº†å—ï¼Ÿ`,
      time: '1å°æ™‚å‰',
      likes: 2,
      isLiked: false,
      replies: [],
    },
    {
      author: 'èƒŒåŒ…å®¢A',
      content: `è«‹å•ä½ å€‘çš„é ç®—æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä¸»è¦æƒ³æ‰¾èƒ½åˆ†æ”¤ä½å®¿çš„æ—…ä¼´ã€‚`,
      time: '2å°æ™‚å‰',
      likes: 5,
      isLiked: false,
      replies: [],
    },
    {
      author: 'å²åŠªæ¯”',
      content: `æˆ‘å‰›å¥½æœ‰ç›¸é—œç¶“é©—ï¼é€™é€±æœ«å¯ä»¥ç´„æ™‚é–“ç·šä¸Šè¨è«–å—ï¼Ÿ`,
      time: '3å°æ™‚å‰',
      likes: 1,
      isLiked: false,
      replies: [
        {
          author: 'ä½œè€…',
          content: `@å²åŠªæ¯” å¥½çš„ï¼Œè«‹ç§è¨Šæˆ‘ Line IDï¼Œæˆ‘å€‘è©³è«‡ã€‚`,
          time: '5åˆ†é˜å‰',
          likes: 0,
          isLiked: false,
        },
      ],
    },
  ]

  const totalCount =
    commentsData.length + commentsData.reduce((sum, c) => sum + c.replies.length, 0)

  return {
    commentsData: commentsData.map((c, index) => ({
      ...c,
      id: postId * 1000 + index,
      avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${c.author}`,
    })),
    commentsCount: totalCount,
  }
}

export const useTravelersStore = defineStore('travelers', () => {
  // --- æ—…ä¼´æ¨è–¦æ•¸æ“š ---
  const recommendations = ref(
    Array.from({ length: 10 }, (_, i) => {
      const request = travelerRequests[i]
      const comments = generateTravelerComments(i + 1, request.title)
      const persona = travelPersonalities[i % travelPersonalities.length] // ç²å–æ—…éŠäººæ ¼

      return {
        id: i + 1,
        title: request.title,
        content: request.content,
        location: request.location,
        status: request.status,
        people: request.people,
        image: `https://picsum.photos/400/300?random=${i + 1}`,
        tag: request.tag,
        author: [
          'Jovi',
          'é˜¿å…‰',
          'å°é›¨',
          'å²åŠªæ¯”',
          'Backpacker',
          'Foodie',
          'TravelerA',
          'CatLover',
          'MountainMan',
          'ç¨è¡Œä¿ ',
        ][i],
        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${i + 10}`,
        spiritAnimal: `${persona.emoji} ${persona.label}`,

        date: `2026/0${(i % 12) + 1}/15`,
        tags: getRandomTags(availableTags.length),
        comments: comments.commentsCount,
        commentsData: comments.commentsData,
      }
    }),
  )

  return {
    recommendations,
  }
})
